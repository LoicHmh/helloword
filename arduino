#include <Wire.h>
#include <L3G4200D.h>
#define EMAoffset 0.05
#define Gyr_Gain 0.076335877862595  // 1/131,250dps
float angleG;
float G_offset;
float gyroSpeed;
unsigned long timer = 0;


L3G4200D gyro;

void setup() {
  Serial.begin(9600);
  Wire.begin();
  gyro.enableDefault();
  delay(500);
}

void loop() {
  long o_timer = timer;
  timer = millis(); 
  int dt = timer - o_timer;
  gyro.read();
  G_offset = EMAoffset *(gyro.g.x - 55) / 131 + (1-EMAoffset) * G_offset; 
  gyroSpeed = (gyro.g.x - 55) / 131 - G_offset; 
  angleG = angleG + gyroSpeed * dt / 1000;
  Serial.print("angle_x: ");
  Serial.print(angleG,6);
  Serial.println(";");   
  delay(100);
}
